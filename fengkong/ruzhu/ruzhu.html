<!--备案管理  -->
<div class="container-fluid">
	<div class="col-sm-12 plr0 height100 gridBox" id="ruzhu_gridBox">
		<table id="ruzhu_jqGrid"></table>
		<div id="ruzhu_jqGridPager"></div>
	</div>
</div>

<!-- 新增弹窗 -->
<div id="ruzhu_formBox" class="layerFormBox">
	<form class="form-horizontal layerForm">
		<div class="form-group">
			<label for="inputEmail3" class="col-xs-3 control-label">
				角色CODE:
			</label>
			<div class="col-xs-8">
				<input type="text" id="ruzhu_relName" name="relName" class="form-control input-sm"  placeholder="角色CODE">
			</div>
		</div>
		<div class="form-group">
			<label class="col-xs-3 control-label">
				角色名称:
			</label>
			<div class="col-xs-8">
				<input type="text" id="ruzhu_name" name="name" class="form-control input-sm"  placeholder="角色名称">
			</div>
		</div>
		<div class="form-group">
			<label class="col-xs-3 control-label">
				创建时间:
			</label>
			<div class="col-xs-8">
				<input type="text" id="ruzhu_createTime" name="createTime" class="form-control input-sm"  placeholder="创建时间">
			</div>		
		</div>
		<div class="form-group">
			<label class="col-xs-3 control-label">
				所属机构:
			</label>
			<div class="col-xs-8">
				<select id="ruzhu_company" name="company" class="form-control input-sm">
					<option value="小笨鸟总部" selected="true">小笨鸟总部</option>
					<option value="运保一部" >运保一部</option>
				</select>
			</div>
		</div>
		<p class="text-center">
			<button type="button" class="saveBtn btn btn-info btn-sm" id="ruzhu_save_btn">
				保存
			</button>
			<button type="reset" class="saveBtn btn btn-info btn-sm">
				重置
			</button>
			<button type="button" class="saveBtn btn btn-info btn-sm" id="ruzhu_cacle_btn">
				取消
			</button>
		</p>
	</form>
</div>
<script type="text/javascript">

	
$(function(){
	var dataUrl = 'data/ruzhu.json';
	var index = null;
	var flag = '';
	var rowNumber = 1000000;
	var gridPager = 'ruzhu_jqGridPager';
	//表格数据
	var gridWidth = $('#ruzhu_gridBox').width();
	var gridHeight = $('#ruzhu_gridBox').height()-150;
	$("#ruzhu_jqGrid").jqGrid({
		
		hidegrid : false, 
		altRows : true, 
		colModel: [{label : '企业名称', name : 'company', align: 'center', width: 120},
			{label : '海关代码', name : 'seanumber', align: 'center', width:120},
			{label : '纳税人识别号', name : 'number', align: 'left', width:120},
			{label : '企业类型', name : 'type', align: 'center', width:120},
			{label : '数据来源', name : 'source', align: 'center', width:120},
			{label : '信用等级', name : 'level', align: 'center', width:120},
			{label : '黑名单', name : 'black', align: 'center', width:120},
			{label : '状态', name : 'active', align: 'center', width:120}],
		viewrecords: true,
		loadonce:true,
		width: gridWidth,
		//width: 'auto',
		//width : '100%',
		height: gridHeight,
		//height : 'auto',
		rowNum: 11,
		rowList:[10,15,20,25],
		datatype: 'local',
		pager: '#'+gridPager,
		multiselect: true,
		recordtext: "当前显示: <b>{0}</b>至<b>{1}</b> 总数: <b>{2}</b>",
	    //emptyrecords: "No records to view",
		//loadtext: "Loading...",
		
	}).navGrid('#'+gridPager,{ // the buttons to appear on the toolbar of the grid
		edit:false,add:false,del:false,search:false,refresh:false
	}).navButtonAdd('#'+gridPager,{
		//caption: '刷新',
		caption: '',
		title : '刷新',
		buttonicon : 'glyphicon-refresh',
		onClickButton : function(){refresh();}, //调用添加的函数
		position : 'last'
		
	}).navButtonAdd('#'+gridPager,{
		//caption: '新增',
		caption: '',
		title : '新增',
		buttonicon : 'glyphicon-plus',
		onClickButton : function(){addLayer();}, //调用添加的函数
		position : 'last'
		
	}).navButtonAdd('#'+gridPager,{
		//caption: '审核',
		caption: '',
		title : '审核',
		buttonicon : 'fa fa-gavel',
		onClickButton : function(){shenhe();}, //调用审核的函数
		position : 'last'
		
	}).navButtonAdd('#'+gridPager,{
		//caption: '导入合同',
		caption: '',
		title : '导入合同',
		buttonicon : 'fa fa-upload',
		onClickButton : function(){importLayer();}, //调用导入合同函数
		position : 'last'
			
	}).navButtonAdd('#'+gridPager,{
		//caption: '统计',
		caption: '',
		title : '报表统计',
		buttonicon : 'fa fa-bar-chart-o',
		onClickButton : function(){chukoutongji();}, //调用报表统计的函数
		position : 'last'
		
	}).navButtonAdd('#'+gridPager,{
		//caption: '删除',
		caption: '',
		title : '删除',
		buttonicon : 'glyphicon-trash',
		//onClickButton : deleteLayer(gridId), //调用删除的函数
		onClickButton : function(){ deleteLayer(gridId); },
		position : 'last'
		
	}).navSeparatorAdd('#'+gridPager,{
		sepcontent: '',
		sepclass : "ui-separator"
	});
	//搜索框按钮,开启搜索框需要重新调整高度
	$('#ruzhu_jqGrid').jqGrid('filterToolbar');
	
	fetchGridData();
	
	//editGridRow新增记录；viewGridRow查看记录详情；delGridRow删除记录。
	
	
	
	//弹框取消按钮
	$('#ruzhu_cacle_btn').on('click',function(){
		layer.close(index);
	});
	
	
	
	//弹框保存按钮
	$(document).on('click','#ruzhu_save_btn',function(){
		//var total = jQuery("#ruzhu_jqGrid").jqGrid('getGridParam', 'records'); 
		////console.log(total);
		//addRowData
		//rowid,data, position, srcrowid
		//console.log(flag);
		if(flag == 'add'){
			var data = {
					"name": $.trim($('#ruzhu_name').val()),
				    "relName": $.trim($('#ruzhu_relName').val()),
				    "company": $.trim($('#ruzhu_company').val()),
				    "createTime": $.trim($('#ruzhu_createTime').val())
			};
			var currentNumber = rowNumber++;
			var result = jQuery("#ruzhu_jqGrid").addRowData(currentNumber,data,'first');
			
			if(result){
				layer.msg('添加成功');
				layer.close(index);
				
				jQuery("#ruzhu_jqGrid").setSelection(currentNumber,true);
				
			}else{
				layer.msg('添加失败!');
			}
		}else if(flag == 'update'){
			
			//删除
			var rowIds = getSelectedRow();
			jQuery("#ruzhu_jqGrid").delRowData(rowIds[0]);
			//添加
			var data = {
					"name": $.trim($('#ruzhu_name').val()),
				    "relName": $.trim($('#ruzhu_relName').val()),
				    "company": $.trim($('#ruzhu_company').val()),
				    "cteateTime": $.trim($('#ruzhu_cteateTime').val())
			};
			var currentNumber = rowNumber++;
			var result = jQuery("#ruzhu_jqGrid").addRowData(currentNumber,data,'first');
			
			if(result){
				layer.msg('更新成功');
				layer.close(index);
				jQuery("#ruzhu_jqGrid").setSelection(currentNumber,true);
			}else{
				layer.msg('更新失败!');
			}
		}
		
	});
	
	//左下角新增按钮
	function addLayer(){
		flag = 'add';
		$('#'+formBoxId+' .form-control:not(select)').val('');
		layerIndex = layer.open({
			type: 1,
			title : '添加模块',
			area: ['98%', '98%'], //宽高
			content: $('#'+formBoxId)
		});
	}
	
	//左下角编辑按钮
	function updateLayer(){
		flag = 'update';
		var setting = {
			gridId : gridId,
			formBoxId : formBoxId,
			title : '修改模块',
			area : ['98%', '98%']
		};
		layerIndex = updateGridData(setting);
	}
	//审核
	function shenhe(){
		var rowIds = getSelectedRow(gridId);
		if(rowIds && $.isArray(rowIds) && rowIds.length == 1 ){
			var rowData = $('#'+gridId).getRowData(rowIds[0]);
			commIndex = layer.open({
				type : 1,
				title : '审核窗口',
				skin: 'layui-layer-rim',
				shadeClose: true,
				area : ['30%','40%'],
				content : '<div class="container-fluid"><div class="row"><div class="col-sm-12" style="padding-top:15px;"><div class="radio-inline"><label><input type="radio" name="a" checked="true"/>审核不通过</label></div><div class="radio-inline"><label><input type="radio" name="a"/>审核通过</label></div><textarea class="form-control" rows="3" placeholder="审核意见..."></textarea><p class="text-center" style="margin-top:15px;"><button class="btn btn-info btn-sm qx">保存</button></p></div></div></div>'
			});
		}else{
			layer.msg('请选择一条记录!',{time:layerCloseTime});
		}
		
	}
	//左下角删除按钮
	function deleteLayer(gridId){
		deleteGridData(gridId);
	}
	//统计
	function chukoutongji(){
		commIndex = layer.open({
			type : 1,
			title : '报表统计',
			skin: 'layui-layer-rim',
			shadeClose: true,
			area : ['90%','90%'],
			content : $('#chukou_bbtj')
		});
	}
	//导入合同
	function importLayer(){
		commIndex = layer.open({
			type: 1,
			title : "导入合同",
			area: ['80%', '60%'], //宽高
			content: $('#chukou_import_formBox')
		});
	}
	
	//获取json数据
	function fetchGridData() {

		var gridArrayData = [];
		// show loading message
		$("#ruzhu_jqGrid")[0].grid.beginReq();
		$.ajax({
			url: dataUrl,
			success: function(result) {
				for (var i = 0; i < result.items.length; i++) {
					var item = result.items[i];
					
					gridArrayData.push({
						company: item.company,
						seanumber: item.seanumber,
						number: item.number,
						type: item.type,
						source: item.source,
						level: item.level,
						black: item.black,
						active: item.active
					});

				}
				// set the new data
				$("#ruzhu_jqGrid").jqGrid('setGridParam', {
					data: gridArrayData
				});
				// hide the show message
				$("#ruzhu_jqGrid")[0].grid.endReq();
				// refresh the grid
				$("#ruzhu_jqGrid").trigger('reloadGrid');
			}
		});
	}
	//格式化标题
	function formatTitle(cellValue, options, rowObject) {
		return cellValue.substring(0, 50) + "...";
	};
	//格式化链接
	function formatLink(cellValue, options, rowObject) {
		return "<a href='" + cellValue + "'>" + cellValue.substring(0, 25) + "..." + "</a>";
	};
	//获取选择的行
	function getSelectedRow() {
	    var grid = $("#ruzhu_jqGrid");
	    var rowKeys = grid.jqGrid('getGridParam',"selarrrow");

	   return rowKeys;
	}
	
	
	changeSearch(); //修改工具条
	
});


	
</script>