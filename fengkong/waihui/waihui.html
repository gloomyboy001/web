<!--外汇核销  -->
<style type="text/css">
#yulu_formBox .text-center{
text-align: center;
}
#yulu_formBox .text-left{
text-align: left;
}
#yulu_formBox .index {
	z-index: 23452523;
}
#yulu_formBox .table {
	border: 1px solid #ccc;
}
/* .table td{
	border: 1px solid #ccc;
}
.table th{
	border: 1px solid #ccc;
} */
#yulu_formBox .thead{
	width: 100%;
}
#yulu_formBox .yulu_ul {
	list-style: none;
}
#yulu_formBox .text-center{
	text-align: center;
}
#yulu_formBox .index {
	border: 1px solid #ccc;
}
#yulu_formBox .head {
	padding-top: 5px;
}
#yulu_formBox .form-group {
	/*border: 1px solid #ccc !important;*/
	/* background: #D9DEF7; */
}
#yulu_formBox .form-group label{
	margin-top: 2px;
}
#yulu_formBox .form-group .form-control {
	vertical-align:middle !important; 
	margin-top: 5px;
}
</style>
<div class="container-fluid">
	<div class="col-sm-12 plr0 height100 gridBox" id="waihui_gridBox">
		<table id="waihui_jqGrid"></table>
		<div id="waihui_jqGridPager"></div>
	</div>
</div>

<!-- 新增弹窗 -->
<div id="waihui_formBox" class="layerFormBox">
	<form class="form-horizontal layerForm col-xs-12">
		<h4 class="col-xs-12 text-center">报关单</h4>
		<div class="col-xs-12 index">
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					预录入编号:
				</label>
				<div class="col-xs-8">
					<input type="text" id="yulu_number" name="number" class="form-control input-sm" value="000000000092371271">
				</div>
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					海关编号:
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm">
				</div>
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					出口口岸
				</label>
				<div class="col-xs-8">
					<input type="text" id="yulu_type" name="type" class="form-control input-sm" value="天津新港">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					备案号
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					出口日期
				</label>
				<div class="col-xs-8">
					<input type="text" id="yulu_outTime" onclick="WdatePicker();" name="outTime" class="form-control input-sm" value="2014-10-19">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					申报日期
				</label>
				<div class="col-xs-8">
					<input type="text" id="yulu_county" onclick="WdatePicker();" name="createTime" class="form-control input-sm" value="2015-01-29">
				</div>		
			</div>

			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					经营单位
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm" value="某集团工程有限公司">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					运输方式
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm" value="水路运输">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					运输工具
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm" value="轮船">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					提运单号
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm">
				</div>		
			</div>

			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					发货单位
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm" value="某集团工程有限公司">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					贸易方式
				</label>
				<div class="col-xs-8">
					<input type="text" id="yulu_property" name="property" class="form-control input-sm" value="一般贸易">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					征免性质
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					提运单号
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm">
				</div>		
			</div>

			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					许可证号
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label" value="s2566764">
					运抵国
				</label>
				<div class="col-xs-8">
					<input type="text" id="yulu_company" name="company" class="form-control input-sm" value="美国">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					指运港
				</label>
				<div class="col-xs-8">
					<input type="text" id="yulu_anothertype" name="anothertype" class="form-control input-sm" value="波士顿">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					境内货源地
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm">
				</div>		
			</div>

			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					批准文号
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm" value="PZX63D832">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					成交方式
				</label>
				<div class="col-xs-8">
					<input type="text" id="yulu_pay" name="pay" class="form-control input-sm" value="FOB">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					运费
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					保费
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					杂费
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm">
				</div>		
			</div>

			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					合同协议号
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm" value="4520000254">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					件数
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm" value="32">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					包装种类
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					毛重（kg）
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					净重（kg）
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm">
				</div>		
			</div>

			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					集装箱号
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					随附单据
				</label>
				<div class="col-xs-8">
					<input type="text" id="yulu_accessory" name="accessory" class="form-control input-sm">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					生产厂家
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm">
				</div>		
			</div>

			<div class="form-group col-xs-12">
				<label class="col-xs-2 control-label text-center">
					标记码及备注
				</label>
				<div class="col-xs-10">
					<textarea type="text" class="form-control input-sm"></textarea>.
				</div>		
			</div>
			<div id="yulu_ul col-xs-12">
				<table class="table col-xs-12">
					<thead class="thead">
						<tr>
							<th>项号</th>
							<th>商品编号</th>
							<th>商品名称 规格型号</th>
							<th>数量及单位</th>
							<th>最终目的国（地区）</th>
							<th>单价</th>
							<th>总价</th>
							<th>币值</th>
							<th>征免</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td>1</td>
							<td>4019991010</td>
							<td>钻井防滑板|无品牌|无型号</td>
							<td>50  个</td>
							<td>美国</td>
							<td>193.36</td>
							<td>9668.08</td>
							<td>美元</td>
							<td></td>
						</tr>
						<tr>
							<td>2</td>
							<td>3544492100</td>
							<td>电缆|传输电力|无型号|400伏</td>
							<td>0.8  千米</td>
							<td>美国</td>
							<td>1012.42</td>
							<td>10731.69</td>
							<td>美元</td>
							<td></td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
		<p class="text-center col-xs-12">
			<button type="button" class="saveBtn btn btn-info btn-sm" id="yulu_save_btn">
				打印
			</button>
			<button type="button" class="saveBtn btn btn-info btn-sm qx">
				取消
			</button>
		</p>
	</form>
</div>


<div id="waihui_shouhui_formBox" class="layerFormBox">
	<div class="text-center col-xs-12">
		您确定要收汇吗？
	</div>
	<div class="col-xs-12 text-center" style="margin-top: 20px;">
		<button class="saveBtn btn btn-info btn-sm qx">确定</button>
		<button class="saveBtn btn btn-info btn-sm qx">取消</button>
	</div>
</div>

<script type="text/javascript">

	
$(function(){
	
	//-------------------------------//
	var layerIndex = null; //弹窗id,关闭所用
	var flag = ''; //添加修改标记
	var dataUrl = 'data/waihui.json';//数据源链接
	var gridId = 'waihui_jqGrid'; //表格id
	var gridPager = 'waihui_jqGridPager'; //表格分页id
	var formBoxId = 'waihui_jqGrid_formBox'; //添加修改窗口元素id
	var layerCloseClassName = 'qx';
	var dataSaveBtn = 'waihui_save_btn'; //弹窗保存id
	var gridBoxId = 'waihui_gridBox';//表格尺寸
	var layerCloseTime = 1200; //1200毫秒提示消息关闭延迟时间
	var gridWidth = $('#'+gridBoxId).width();
	var gridHeight = $('#'+gridBoxId).height()-118;
	
	var colModel = [
			{label : '关单号', name : 'id', align: 'center', width: 120,search:false, formatter: formatName},
			{label : '出口口岸', name : 'kouan', align: 'center', width: 120,search:false},
			{label : '贸易类型', name : 'type', align: 'center', width:120,search:false},
			{label : '运抵国', name : 'dyg', align: 'center', width: 120,search:false},
			{label : '出口日期', name : 'ckDate', align: 'center', width:120},
			{label : '收汇状态', name : 'rate', align: 'center', width:120,formatter:formatRelated},
		
		];
/*
id: 'WH{{integer(100000, 200000)}}',
kouan: '{{random("平谷海关", "京中关村", "京国际局","十八里店","京调查局","天津海关","津开发区","津机场办","唐山海关")}}',
dyg: '{{random("美国", "台湾", "英国","韩国","俄罗斯","朝鲜","印度")}}',
ckDate: '{{date(new Date(2017, 0, 1), new Date(), "YYYY-MM-dd")}}',
type: '{{random("一般贸易", "外综服务", "承包商")}}',
rate: '{{integer(10, 80)}}%'
*/
	
	$('#'+gridId).jqGrid({
		width: gridWidth,
		height: gridHeight,
		url: dataUrl,
		datatype: "json",
		loadonce: true, //加载到本地操作
		rownumbers: true, //显示顺序编号
		multiselect: true, //定义多选
		viewrecords: true, //显示总记录数
		sortname: 'name', //排序字段
		sortorder: 'asc', //排序顺序，升序或者降序（asc or desc）
		altRows : true, //设置表格隔行变色
		rowNum: 12, //每页显示的记录数
		rowList:[10,12,15,18,20,25], //
		rownumWidth: 30, 
		recordtext: "当前显示: <b>{0}</b>至<b>{1}</b> 总数: <b>{2}</b>",
		//emptyrecords: "No records to view",
		//loadtext: "Loading...",
		pager: '#'+gridPager,
		colModel: colModel
		//jsonReader : jsonReader
		
	})
	/*
	.navButtonAdd('#'+gridPager,{
		//caption: '新增',
		caption: '',
		title : '添加',
		buttonicon : 'glyphicon-plus',
		onClickButton : function(){addLayer();}, //调用添加的函数
		position : 'last'
		
	}).navButtonAdd('#'+gridPager,{
		//caption: '修改',
		caption: '',
		title : '修改',
		buttonicon : 'glyphicon-edit',
		onClickButton : function(){updateLayer();}, //调用更新的函数
		position : 'last'
		
	}).navButtonAdd('#'+gridPager,{
		//caption: '删除',
		caption: '',
		title : '删除',
		buttonicon : 'glyphicon-trash',
		//onClickButton : deleteLayer(gridId), //调用删除的函数
		onClickButton : function(){ deleteLayer(gridId); },
		position : 'last'
		
	}).navSeparatorAdd('#'+gridPager,{
		sepcontent: '',
		sepclass : "ui-separator"
	});
	
	*/
	
	//表格添加搜索框按钮
	$('#'+gridId).jqGrid('filterToolbar');
	//修改工具条
	changeSearch(); 
	
	//editGridRow新增记录；viewGridRow查看记录详情；delGridRow删除记录。
	//格式化标题
	function formatName(cellValue, options, rowObject) {
		var len = cellValue.length;
		if(len>50){
			cellValue = cellValue.substring(0, 50) + "...";
		}
		return '<a href="javascript:;" onclick="lookInfo(\''+options.gid+'\',\''+options.rowId+'\')">'+cellValue+'</a>';
	};
	function formatRelated(cellValue, options, rowObject) {
		if (cellValue) {
			var len = cellValue.length;
			if(len>50){
					cellValue = cellValue.substring(0, 50) + "...";
			}
			return '<a href="javascript:;" onclick="lookcai()">'+cellValue+'</a>';
		}
	};
	//弹框保存按钮
	$(document).on('click','#'+dataSaveBtn,function(){
		if(flag == 'add'){
			var data = getFormData(formBoxId);
			var currentNumber = uuid.v4();
			var result = jQuery('#'+gridId).addRowData(currentNumber,data,'first');
			if(result){
				layer.msg('添加成功',{time:layerCloseTime});
				layer.close(layerIndex);
				
				jQuery('#'+gridId).setSelection(currentNumber,true);
				
			}else{
				layer.msg('添加失败!',{time:layerCloseTime});
			}
		}else if(flag == 'update'){
			
			//删除
			var rowIds = getSelectedRow(gridId);
			jQuery('#'+gridId).delRowData(rowIds[0]);
			//添加
			var data = getFormData(formBoxId);
			console.log(data);
			var currentNumber = uuid.v4();
			var result = jQuery('#'+gridId).addRowData(currentNumber,data,'first');
			
			if(result){
				layer.msg('更新成功',{time:layerCloseTime});
				layer.close(layerIndex);
				jQuery('#'+gridId).setSelection(currentNumber,true);
			}else{
				layer.msg('更新失败!',{time:layerCloseTime});
			}
		}
		
	});
	
	//弹框取消按钮
	$('.'+layerCloseClassName).on('click',function(){
		layer.close(layerIndex);
	});
	
	//左下角新增按钮
	function addLayer(){
		flag = 'add';
		$('#'+formBoxId+' .form-control:not(select)').val('');
		layerIndex = layer.open({
			type: 1,
			title : '新增',
			area: ['98%', '98%'], //宽高
			content: $('#'+formBoxId)
		});
	}
	
	//左下角编辑按钮
	function updateLayer(){
		flag = 'update';
		var setting = {
			gridId : gridId,
			formBoxId : formBoxId,
			title : '修改',
			area : ['98%', '98%']
		};
		layerIndex = updateGridData(setting);
	}
	
	//左下角删除按钮
	function deleteLayer(gridId){
		deleteGridData(gridId);
	}
	
	
	//-------------------------------//
	
	//查看
	function lookInfo(){
		var setting = {
			gridId : gridId,
			formBoxId : formBoxId,
			title : '信息',
			area : ['90%', '90%']
		};
		layerIndex = updateGridData(setting);
	}
	
	//收汇
	// function shouhui(){
	// 	flag == 'update';
	// 	var rowIds = getSelectedRow(gridId);
	// 	if(rowIds && $.isArray(rowIds) && rowIds.length == 1 ){
	// 		var rowData = $('#'+gridId).getRowData(rowIds[0]);
	// 		commIndex = layer.open({
	// 			type: 1,
	// 			title : '收汇',
	// 			area: ["90%","80%"], //宽高
	// 			content: $('#waihui_shouhui_formBox')
	// 		});
	// 	}else{
	// 		layer.msg('只能选择一条关单!',{time:layerCloseTime});
	// 	}
		
	// }
	
	
});
function lookInfo(gid,rowId){
	var data = $('#'+gid).getRowData(rowId);
	data.name = $(data.name).text();
	data.relName = $(data.relName).text();
	setFormData(gid+'_formBox',data);
	title = '报关单查看信息';
	commIndex = layer.open({
		type: 1,
		title : title,
		area: ['98%', '98%'], //宽高
		content: $('#waihui_formBox')
	});
}
function lookcai(rowId){
	var data = $('#cai_jqGrid').getRowData(rowId);
	data.related = $(data.related).text();
	setFormData('cai_jqGrid',data);
	title = '信息';
	commIndex = layer.open({
		type: 1,
		title : title,
		area: ['30%', '30%'], //宽高
		content: $('#waihui_shouhui_formBox')
	});
}

	
</script>