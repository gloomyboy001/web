<!--任务预警  -->
<div class="container-fluid">
	<div class="col-sm-12 plr0 height100 gridBox" id="renwu_gridBox">
		<table id="renwu_jqGrid"></table>
		<div id="renwu_jqGridPager"></div>
	</div>
</div>

<script type="text/javascript">

	
$(function(){
	var dataUrl = 'data/renwu.json';
	var index = null;
	var flag = '';
	var rowNumber = 1000000;

	//表格数据
	var gridWidth = $('#renwu_gridBox').width()-2;
	var gridHeight = $('#renwu_gridBox').height()-118;
	$("#renwu_jqGrid").jqGrid({
		
		hidegrid : false, 
		altRows : true, 
		colModel: [{label : '任务编号', name : 'tasknumber', align: 'center', width: 120},
			{label : '出口国别', name : 'country', align: 'center', width:120},
			{label : '业务类型', name : 'guandannumber', align: 'center', width:120},
			{label : '出口口岸', name : 'guandannumber', align: 'center', width:120},
			{label : '运输方式', name : 'guandannumber', align: 'center', width:120},
			{label : '当前环节', name : 'type', align: 'center', width:120},
			{label : '创建人', name : 'startTime', align: 'center', width:120},
			{label : '创建时间', name : 'startTime', align: 'center', width:120},
			{label : '剩余时间', name : 'overTime', align: 'center', width:120}],
		viewrecords: true,
		loadonce:true,
		width: gridWidth,
		//width: 'auto',
		//width : '100%',
		height: gridHeight,
		//height : 'auto',
		rowNum: 11,
		rowList:[10,15,20,25],
		datatype: 'local',
		pager: "#renwu_jqGridPager",
		rownumbers: true,
		rownumWidth: 30,
		recordtext: "当前显示: <b>{0}</b>至<b>{1}</b> 总数: <b>{2}</b>"
		
	}).navButtonAdd('#renwu_jqGridPager',{
		//caption: '查看',
		caption: '',
		title : '解除预警',
		buttonicon : 'fa fa-times',
		onClickButton : function(){ remove(); }, //调用查看的函数
		position : 'last'
	});
	//搜索框按钮,开启搜索框需要重新调整高度
	$('#renwu_jqGrid').jqGrid('filterToolbar');
	
	fetchGridData();
	
	//editGridRow新增记录；viewGridRow查看记录详情；delGridRow删除记录。
	
	
	
	//弹框取消按钮
	$('#renwu_cacle_btn').on('click',function(){
		layer.close(index);
	});
	function remove(){
		
	}
	
	
	//弹框保存按钮
	$(document).on('click','#renwu_save_btn',function(){
		//var total = jQuery("#renwu_jqGrid").jqGrid('getGridParam', 'records'); 
		////console.log(total);
		//addRowData
		//rowid,data, position, srcrowid
		//console.log(flag);
		if(flag == 'add'){
			var data = {
					"name": $.trim($('#renwu_name').val()),
				    "relName": $.trim($('#renwu_relName').val()),
				    "company": $.trim($('#renwu_company').val()),
				    "createTime": $.trim($('#renwu_createTime').val())
			};
			var currentNumber = rowNumber++;
			var result = jQuery("#renwu_jqGrid").addRowData(currentNumber,data,'first');
			
			if(result){
				layer.msg('添加成功');
				layer.close(index);
				
				jQuery("#renwu_jqGrid").setSelection(currentNumber,true);
				
			}else{
				layer.msg('添加失败!');
			}
		}else if(flag == 'update'){
			
			//删除
			var rowIds = getSelectedRow();
			jQuery("#renwu_jqGrid").delRowData(rowIds[0]);
			//添加
			var data = {
					"name": $.trim($('#renwu_name').val()),
				    "relName": $.trim($('#renwu_relName').val()),
				    "company": $.trim($('#renwu_company').val()),
				    "cteateTime": $.trim($('#renwu_cteateTime').val())
			};
			var currentNumber = rowNumber++;
			var result = jQuery("#renwu_jqGrid").addRowData(currentNumber,data,'first');
			
			if(result){
				layer.msg('更新成功');
				layer.close(index);
				jQuery("#renwu_jqGrid").setSelection(currentNumber,true);
			}else{
				layer.msg('更新失败!');
			}
		}
		
	});
	
	
	
	//表头新增按钮
	$(document).on('click','#renwu_add_btn',function(){
		flag = 'add';
		$('.form-control').val('');
		index = parent.layer.open({
			type: 1,
			title : '添加模块',
			area: ['60%', '70%'], //宽高
			content: $('#renwu_formBox')
		});
	});
	
	//表头编辑按钮
	$(document).on('click','#renwu_update_btn',function(){
		flag = 'update';
		var rowIds = getSelectedRow();
		
		if(rowIds && $.isArray(rowIds) && rowIds.length == 1 ){
			
			var rowData = $("#renwu_jqGrid").getRowData(rowIds[0]);
			
			//console.log(rowData);
			
			$('#renwu_name').val(rowData.name),
		    $('#renwu_relName').val(rowData.relName),
		    $('#renwu_company').val(rowData.company),
		    $('#renwu_createTime').val(rowData.createTime)
			title = '修改模块';
			index = layer.open({
				type: 1,
				title : title,
				area: ['60%', '70%'], //宽高
				content: $('#renwu_formBox')
			});
		}else{
			layer.msg('同时只能选择一条记录!');
		}
	});
	
	
	//获取json数据
	function fetchGridData() {

		var gridArrayData = [];
		// show loading message
		$("#renwu_jqGrid")[0].grid.beginReq();
		$.ajax({
			url: dataUrl,
			success: function(result) {
				for (var i = 0; i < result.items.length; i++) {
					var item = result.items[i];
					
					gridArrayData.push({
						tasknumber: item.tasknumber,
						guandannumber: item.guandannumber,
						country: item.country,
						type: item.type,
						startTime: item.startTime,
						endTime: item.endTime,
						yujingnumber: item.yujingnumber,
						overTime: item.overTime
					});

				}
				// set the new data
				$("#renwu_jqGrid").jqGrid('setGridParam', {
					data: gridArrayData
				});
				// hide the show message
				$("#renwu_jqGrid")[0].grid.endReq();
				// refresh the grid
				$("#renwu_jqGrid").trigger('reloadGrid');
			}
		});
	}
	//格式化标题
	function formatTitle(cellValue, options, rowObject) {
		return cellValue.substring(0, 50) + "...";
	};
	//格式化链接
	function formatLink(cellValue, options, rowObject) {
		return "<a href='" + cellValue + "'>" + cellValue.substring(0, 25) + "..." + "</a>";
	};
	//获取选择的行
	function getSelectedRow() {
	    var grid = $("#renwu_jqGrid");
	    var rowKeys = grid.jqGrid('getGridParam',"selarrrow");

	   return rowKeys;
	}
	
	
	changeSearch(); //修改工具条
	
});


	
</script>